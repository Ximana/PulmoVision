<!-- Modal de Edição -->
<div class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="modalEditarLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEditarLabel">Editar Radiografia</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="{% url 'radiografias:editar' radiografia.pk %}"  class="row" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Informações do paciente (somente leitura) -->
            <div class="col-12 mb-3">
              <div class="alert alert-info">
                <h6 class="mb-0">Paciente: {{ radiografia.paciente.get_nome_completo }}</h6>
              </div>
            </div>
  
            <div class="col-md-6">
              <!-- Data do Exame -->
              <div class="form-group mb-3">
                <label for="data">Data do Exame</label>
                <input type="date" class="form-control {% if form.data.errors %}is-invalid{% endif %}"
                       id="data" name="data" value="{{ radiografia.data|date:'Y-m-d' }}" required>
                {% if form.data.errors %}
                  <div class="invalid-feedback">{{ form.data.errors|first }}</div>
                {% endif %}
              </div>
  
              <!-- Tipo de Exame -->
              <div class="form-group mb-3">
                <label for="tipo">Tipo de Exame</label>
                <select class="form-select {% if form.tipo.errors %}is-invalid{% endif %}"
                        id="tipo" name="tipo" required>
                  <option value="">Selecione...</option>
                  {% for value, label in form.fields.tipo.choices %}
                    <option value="{{ value }}" {% if radiografia.tipo == value %}selected{% endif %}>
                      {{ label }}
                    </option>
                  {% endfor %}
                </select>
                {% if form.tipo.errors %}
                  <div class="invalid-feedback">{{ form.tipo.errors|first }}</div>
                {% endif %}
              </div>
  
              <!-- Equipamento -->
              <div class="form-group mb-3">
                <label for="equipamento_usado">Equipamento Utilizado</label>
                <select class="form-select {% if form.equipamento_usado.errors %}is-invalid{% endif %}"
                        id="equipamento_usado" name="equipamento_usado" required>
                  <option value="">Selecione...</option>
                  {% for value, label in form.fields.equipamento_usado.choices %}
                    <option value="{{ value }}" {% if radiografia.equipamento_usado == value %}selected{% endif %}>
                      {{ label }}
                    </option>
                  {% endfor %}
                </select>
                {% if form.equipamento_usado.errors %}
                  <div class="invalid-feedback">{{ form.equipamento_usado.errors|first }}</div>
                {% endif %}
              </div>
            </div>
  
            <div class="col-md-6">
              <!-- Qualidade da Imagem -->
              <div class="form-group mb-3">
                <label for="qualidade_da_imagem">Qualidade da Imagem</label>
                <select class="form-select {% if form.qualidade_da_imagem.errors %}is-invalid{% endif %}"
                        id="qualidade_da_imagem" name="qualidade_da_imagem" required>
                  <option value="">Selecione...</option>
                  {% for value, label in form.fields.qualidade_da_imagem.choices %}
                    <option value="{{ value }}" {% if radiografia.qualidade_da_imagem == value %}selected{% endif %}>
                      {{ label }}
                    </option>
                  {% endfor %}
                </select>
                {% if form.qualidade_da_imagem.errors %}
                  <div class="invalid-feedback">{{ form.qualidade_da_imagem.errors|first }}</div>
                {% endif %}
              </div>
  
              <!-- Dose de Radiação -->
              <div class="form-group mb-3">
                <label for="dose_de_radiacao">Dose de Radiação (mSv)</label>
                <input type="number" step="0.01" class="form-control {% if form.dose_de_radiacao.errors %}is-invalid{% endif %}"
                       id="dose_de_radiacao" name="dose_de_radiacao" value="{{ radiografia.dose_de_radiacao|default:'' }}">
                {% if form.dose_de_radiacao.errors %}
                  <div class="invalid-feedback">{{ form.dose_de_radiacao.errors|first }}</div>
                {% endif %}
              </div>
  
              <!-- Imagem -->
              <div class="form-group mb-3">
                <label for="imagem">Nova Imagem (opcional)</label>
                <input type="file" class="form-control {% if form.imagem.errors %}is-invalid{% endif %}"
                       id="imagem" name="imagem" accept="image/*">
                {% if radiografia.imagem %}
                  <small class="form-text text-muted">Uma imagem já existe. Envie nova apenas se desejar substituir.</small>
                {% endif %}
                {% if form.imagem.errors %}
                  <div class="invalid-feedback">{{ form.imagem.errors|first }}</div>
                {% endif %}
              </div>
            </div>
  
            <!-- Descrição -->
            <div class="col-12 mb-3">
              <label for="descricao">Descrição</label>
              <textarea class="form-control {% if form.descricao.errors %}is-invalid{% endif %}"
                        id="descricao" name="descricao" rows="3">{{ radiografia.descricao|default:'' }}</textarea>
              {% if form.descricao.errors %}
                <div class="invalid-feedback">{{ form.descricao.errors|first }}</div>
              {% endif %}
            </div>
  
            <!-- Notas Técnicas -->
            <div class="col-12 mb-3">
              <label for="notas_tecnicas">Notas Técnicas</label>
              <textarea class="form-control {% if form.notas_tecnicas.errors %}is-invalid{% endif %}"
                        id="notas_tecnicas" name="notas_tecnicas" rows="3">{{ radiografia.notas_tecnicas|default:'' }}</textarea>
              {% if form.notas_tecnicas.errors %}
                <div class="invalid-feedback">{{ form.notas_tecnicas.errors|first }}</div>
              {% endif %}
            </div>
  
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar Alterações</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>